<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortisApp - Avisos Recibidos</title>
    <link rel="stylesheet" href="../Shared/Shared.css">
</head>
<body>
    <div class="card-container">
        <div class="card">
            <div class="header-with-search">
                <h2>Avisos Recibidos</h2>
                <button id="searchToggleBtn" class="icon-btn" aria-label="Abrir buscador">🔎</button>
            </div>
            
            <div id="searchContainer" class="search-box hidden">
                <input type="text" id="searchInput" placeholder="Buscar por ubicación, modelo, llave, contrato o avería..." class="detail-input">
            </div>
            
            <div class="header-buttons">
                <button id="backBtn" class="btn-secondary">Volver</button>
                <button class="btn-primary-action" id="sendBtn">Enviar</button> 
            </div>

            <div id="listMessageBox" class="message-box hidden"></div>
            
            <div id="damagesList" class="list-container"> 
                <p class="empty-list-message">Cargando...</p>
            </div>
        </div>
    </div>
    <div id="shareModal" class="modal-overlay hidden">
    <div class="card modal-content">
        <h2>Compartir Aviso</h2>
        
        <div id="modalMessageBox" class="message-box hidden"></div>
        
        <div class="input-group">
            <label for="userSelector" style="color: white; margin-top: 20px; font-size: 1.1em; align-self: flex-start;">Usuario de Destino:</label>
            <select id="userSelector" class="detail-input">
                <option value="" disabled selected>Cargando usuarios...</option>
            </select>
        </div>

        <h3 style="color: white; margin-top: 20px; font-size: 1.1em; align-self: flex-start;">Selecciona el Aviso:</h3>
        <div id="shareableDamagesList" class="list-container" style="max-height: 25vh; min-height: 100px; padding: 5px;">
            <p class="empty-list-message">Cargando averías propias...</p>
        </div>
        
        <div class="modal-buttons">
            <button id="modalBackBtn" class="btn-modal-secondary">Volver</button>
            
            <button id="confirmShareBtn" class="btn-modal-primary">Compartir</button>
        </div>
        </div>
</div>
    <script type="module">
        // Importa todas las funciones de Firestore que usas, incluyendo updateDoc
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        //                                                                                ^^^^^^^^^^^ <-- AÑADIDO AQUÍ
        // --- Configuración de Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyD_tC3KaK3UVyNOPiSsnI0s5k8Cd_qFJpg",
            authDomain: "portisapp.firebaseapp.com",
            projectId: "portisapp",
            storageBucket: "portisapp.firebasestorage.app",
            messagingSenderId: "38313359657",
            appId: "1:38313359657:web:ae73a0f8f7556bed92df38",
            measurementId: "G-HQ29Y8Z2DY"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        signInAnonymously(auth).catch(error => console.error("Error en autenticación anónima:", error));

        // Referencias globales para Shared.js
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc; 
        window.query = query;
        window.where = where;
        window.getDocs = getDocs;
        window.doc = doc;
        window.updateDoc = updateDoc; // <--- ASIGNACIÓN CORREGIDA
    </script>
    <script src="../Shared/Shared.js"></script>
</body>
</html>